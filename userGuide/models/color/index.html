

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Color model &mdash; LBPM 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Color model – Centrifuge Protocol" href="protocols/centrifuge.html" />
    <link rel="prev" title="LBPM model summary" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            LBPM
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">User Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">LBPM model summary</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Color model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#simulation-protocols">Simulation protocols</a></li>
<li class="toctree-l4"><a class="reference internal" href="#analysis-capabilities">Analysis capabilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#model-parameters">Model parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#model-formulation">Model Formulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boundary-conditions">Boundary Conditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-data">Example data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../mrt/mrt.html">MRT model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/cell.html">Cell model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../greyscale/greyscale.html">Greyscale model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../greyscaleColor/greyscaleColor.html">Greyscale Color Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../freeEnergy/freeEnergy.html">Free energy model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../visualization/visit.html">Visualizing simulation data with visit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../IO/fileformat.html">I/O conventions for LBPM</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../developerGuide/index.html">Developer guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/running.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications/publications.html">Publications</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">LBPM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">User Guide</a></li>
          <li class="breadcrumb-item"><a href="../index.html">LBPM model summary</a></li>
      <li class="breadcrumb-item active">Color model</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/userGuide/models/color/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="color-model">
<h1>Color model<a class="headerlink" href="#color-model" title="Link to this heading">¶</a></h1>
<p>The LBPM color model is implemented by combining a multi-relaxation time D3Q19
lattice Boltzmann equation (LBE) to solve for the momentum transport with two D3Q7
LBEs for the mass transport. The color model will obey strict mass and momentum
conservation while minimizing diffusive fluxes across the interface between fluids.
The color model is a good choice for modeling dense fluids that are strongly immiscible
(e.g. water-oil systems). Due to the strong anti-diffusion in the interface region,
the color model is not suitable for modeling processes such as Ostwald ripening that
depend on diffusive fluxes between fluid phases.</p>
<p>A typical command to launch the LBPM color simulator is as follows</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">mpirun</span> <span class="pre">-np</span> <span class="pre">$NUMPROCS</span> <span class="pre">lbpm_color_simulator</span> <span class="pre">input.db</span>
<span class="pre">`</span></code></p>
<p>where <code class="docutils literal notranslate"><span class="pre">$NUMPROCS</span></code> is the number of MPI processors to be used and <code class="docutils literal notranslate"><span class="pre">input.db</span></code> is
the name of the input database that provides the simulation parameters.
Note that the specific syntax to launch MPI tasks may vary depending on your system.
For additional details please refer to your local system documentation.</p>
<section id="simulation-protocols">
<h2>Simulation protocols<a class="headerlink" href="#simulation-protocols" title="Link to this heading">¶</a></h2>
<p>Simulation protocols are designed to make it simpler to design and execute common
computational experiments. Protocols will automatically determine boundary conditions
needed to perform a particular simulation. LBPM will internall set default simulation paramaters
that can be over-ridden to develop customized simulations.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="protocols/centrifuge.html">Color model – Centrifuge Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="protocols/coreFlooding.html">Color model – Core Flooding</a></li>
<li class="toctree-l1"><a class="reference internal" href="protocols/fractionalFlow.html">Color model – Fractional Flow Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="protocols/imageSequence.html">Color model – Image Sequence Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="protocols/shellAggregation.html">Color model – Shell Aggregation Protocol</a></li>
</ul>
</div>
</section>
<section id="analysis-capabilities">
<h2>Analysis capabilities<a class="headerlink" href="#analysis-capabilities" title="Link to this heading">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="analysis/basic.html">Color model – Basic Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis/subphase.html">Color model – Subphase Analysis</a></li>
</ul>
</div>
</section>
<section id="model-parameters">
<h2>Model parameters<a class="headerlink" href="#model-parameters" title="Link to this heading">¶</a></h2>
<p>The essential model parameters for the color model are</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code> – control the interfacial tension between fluids – <span class="math">0 &lt; \alpha &lt; 0.01</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">beta</span></code> – control the width of the interface – <span class="math">\beta &lt; 1</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tauA</span></code> – control the viscosity of fluid A – <span class="math">0.7 &lt; \tau_A &lt; 1.5</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tauB</span></code> – control the viscosity of fluid B – <span class="math">0.7 &lt; \tau_B &lt; 1.5</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rhoA</span></code> – control the viscosity of fluid A – <span class="math">0.05 &lt; \rho_A &lt; 1.0</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rhoB</span></code> – control the viscosity of fluid B – <span class="math">0.05 &lt; \rho_B &lt; 1.0</span></p></li>
</ul>
</section>
<section id="model-formulation">
<h2>Model Formulation<a class="headerlink" href="#model-formulation" title="Link to this heading">¶</a></h2>
<p>Two LBEs are constructed to model the mass transport, incorporating the anti-diffusion</p>
<div class="math">
<p><span class="math">$$
A_q(\bm{x} + \bm{\xi}_q \delta t, t+\delta t) = w_q N_a \Big[1 + \frac{\bm{u} \cdot \bm{\xi}_q}{c_s^2}
    + \beta  \frac{N_b}{N_a+N_b} \bm{n} \cdot \bm{\xi}_q\Big] \;
$$</span></p>
</div><div class="math">
<p><span class="math">$$
B_q(\bm{x} + \bm{\xi}_q \delta t, t+\delta t) =
    w_q N_b \Big[1 + \frac{\bm{u} \cdot \bm{\xi}_q}{c_s^2}
    - \beta  \frac{N_a}{N_a+N_b} \bm{n} \cdot \bm{\xi}_q\Big]\;,
$$</span></p>
</div><p>The number density for each fluid is obtained from the sum of the mass transport distributions</p>
<div class="math">
<p><span class="math">$$
N_a = \sum_q A_q\;, \quad    N_b = \sum_q B_q\;
$$</span></p>
</div><p>The phase indicator field is then defined as</p>
<div class="math">
<p><span class="math">$$
\phi = \frac{N_a-N_b}{N_a+N_b}
$$</span></p>
</div><p>The fluid density and kinematic viscosity are determined based on linear interpolation</p>
<div class="math">
<p><span class="math">$$
 \rho_0 = \frac{(1+\phi) \rho_n}{2}+ \frac{(1-\phi) \rho_w}{2} \;,
$$</span></p>
</div><div class="math">
<p><span class="math">$$
 s_\nu = \frac{(1+\phi)}{2\tau_n} +\frac{(1-\phi)}{2\tau_w} \;,
$$</span></p>
</div><p>where</p>
<div class="math">
<p><span class="math">$$
 \nu_w = \frac{1}{3}\Big(\tau_w - \frac{1}{2} \Big) \;, \quad
 \nu_n = \frac{1}{3}\Big(\tau_n - \frac{1}{2} \Big) \;.
$$</span></p>
</div><p>These values are then used to model the momentum transport.
The LBE governing momentum transport is defined based on a MRT relaxation process with additional
terms to account for the interfacial stresses</p>
<div class="math">
<p><span class="math">$$
   f_q(\bm{x}_i + \bm{\xi}_q \delta t,t + \delta t) - f_q(\bm{x}_i,t) = \sum^{Q-1}_{k=0} M^{-1}_{qk} \lambda_{k} (m_k^{eq}-m_k) + w_q \bm{\xi}_q \cdot \frac{\bm{F}}{c_s^2} \;,
$$</span></p>
</div><p>Where <span class="math">\bm{F}</span> is an external body force and <span class="math">c_s^2 = 1/3</span> is the speed of sound for the LB model.
The moments are linearly indepdendent:</p>
<div class="math">
<p><span class="math">$$
   m_k = \sum_{q=0}^{18} M_{qk} f_q\;.
$$</span></p>
</div><p>The relaxation parameters are determined from the relaxation time:</p>
<div class="math">
<p><span class="math">$$
  \lambda_1 =  \lambda_2=  \lambda_9 = \lambda_{10}= \lambda_{11}= \lambda_{12}= \lambda_{13}= \lambda_{14}= \lambda_{15} = s_\nu \;,
$$</span></p>
</div><div class="math">
<p><span class="math">$$
  \lambda_{4}= \lambda_{6}= \lambda_{8} = \lambda_{16} = \lambda_{17} = \lambda_{18}= \frac{8(2-s_\nu)}{8-s_\nu} \;,
$$</span></p>
</div><p>The non-zero equilibrium moments are defined as</p>
<div class="math">
<p><span class="math">$$
  m_1^{eq} = 19\frac{ j_x^2+j_y^2+j_z^2}{\rho_0} - 11\rho - 19 \alpha |\textbf{C}|, \\
$$</span></p>
</div><div class="math">
<p><span class="math">$$
  m_2^{eq} = 3\rho - \frac{11( j_x^2+j_y^2+j_z^2)}{2\rho_0}, \\
$$</span></p>
</div><div class="math">
<p><span class="math">$$
  m_4^{eq} = -\frac{2 j_x}{3}, \\
$$</span></p>
</div><div class="math">
<p><span class="math">$$
  m_6^{eq} = -\frac{2 j_y}{3}, \\
$$</span></p>
</div><div class="math">
<p><span class="math">$$
  m_8^{eq} = -\frac{2 j_z}{3}, \\
$$</span></p>
</div><div class="math">
<p><span class="math">$$
  m_9^{eq} = \frac{2j_x^2-j_y^2-j_z^2}{\rho_0}+ \alpha \frac{|\textbf{C}|}{2}(2n_x^2-n_y^2-n_z^2), \\
$$</span></p>
</div><div class="math">
<p><span class="math">$$
  m_{11}^{eq} = \frac{j_y^2-j_z^2}{\rho_0} + \alpha \frac{|\textbf{C}|}{2}(n_y^2-n_z^2), \\
$$</span></p>
</div><div class="math">
<p><span class="math">$$
  m_{13}^{eq} = \frac{j_x j_y}{\rho_0} + \alpha \frac{|\textbf{C}|}{2} n_x n_y\;, \\
$$</span></p>
</div><div class="math">
<p><span class="math">$$
  m_{14}^{eq} = \frac{j_y j_z}{\rho_0} + \alpha \frac{|\textbf{C}|}{2} n_y n_z\;, \\
$$</span></p>
</div><div class="math">
<p><span class="math">$$
  m_{15}^{eq} = \frac{j_x j_z}{\rho_0} + \alpha \frac{|\textbf{C}|}{2} n_x n_z\;.
$$</span></p>
</div><p>where the color gradient is determined from the phase indicator field</p>
<div class="math">
<p><span class="math">$$
\textbf{C}=\nabla \phi\;.
$$</span></p>
</div><p>and the unit normal vector is</p>
<div class="math">
<p><span class="math">$$
  \bm{n} = \frac{\textbf{C}}{|\textbf{C}|}\;.
$$</span></p>
</div></section>
<section id="boundary-conditions">
<h2>Boundary Conditions<a class="headerlink" href="#boundary-conditions" title="Link to this heading">¶</a></h2>
<p>The following external boundary conditions are supported by <code class="docutils literal notranslate"><span class="pre">lbpm_color_simulator</span></code>
and can be set by setting the <code class="docutils literal notranslate"><span class="pre">BC</span></code> key values in the <code class="docutils literal notranslate"><span class="pre">Domain</span></code> section of the
input file database</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">BC</span> <span class="pre">=</span> <span class="pre">0</span></code> – fully periodic boundary conditions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BC</span> <span class="pre">=</span> <span class="pre">3</span></code> – constant pressure boundary condition</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BC</span> <span class="pre">=</span> <span class="pre">4</span></code> – constant volumetric flux boundary condition</p></li>
</ul>
<p>For <code class="docutils literal notranslate"><span class="pre">BC</span> <span class="pre">=</span> <span class="pre">0</span></code> any mass that exits on one side of the domain will re-enter at the other
side. If the pore-structure for the image is tight, the mismatch between the inlet and
outlet can artificially reduce the permeability of the sample due to the blockage of
flow pathways at the boundary. LBPM includes an internal utility that will reduce the impact
of the boundary mismatch by eroding the solid labels within the inlet and outlet layers
(<a class="reference external" href="https://doi.org/10.1007/s10596-020-10028-9">https://doi.org/10.1007/s10596-020-10028-9</a>) to create a mixing layer.
The number mixing layers to use can be set using the key values in the <code class="docutils literal notranslate"><span class="pre">Domain</span></code> section
of the input database</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">InletLayers</span>&#160; <span class="pre">=</span> <span class="pre">5</span></code> – set the number of mixing layers to <code class="docutils literal notranslate"><span class="pre">5</span></code> voxels at the inlet</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OUtletLayers</span>&#160; <span class="pre">=</span> <span class="pre">5</span></code> – set the number of mixing layers to <code class="docutils literal notranslate"><span class="pre">5</span></code> voxels at the outlet</p></li>
</ul>
<p>For the other boundary conditions a thin reservoir of fluid  (default <code class="docutils literal notranslate"><span class="pre">3</span></code> voxels)
is established at either side of the domain. The inlet is defined as the boundary face
where <code class="docutils literal notranslate"><span class="pre">z</span> <span class="pre">=</span> <span class="pre">0</span></code> and the outlet is the boundary face where <code class="docutils literal notranslate"><span class="pre">z</span> <span class="pre">=</span> <span class="pre">nprocz*nz</span></code>. By default a
reservoir of fluid A is established at the inlet and a reservoir of fluid B is established at
the outlet, each with a default thickness of three voxels. To over-ride the default label at
the inlet or outlet, the <code class="docutils literal notranslate"><span class="pre">Domain</span></code> section of the database may specify the following key values</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">InletLayerPhase</span> <span class="pre">=</span> <span class="pre">2</span></code> – establish a reservoir of component B at the inlet</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OutletLayerPhase</span> <span class="pre">=</span> <span class="pre">1</span></code> – establish a reservoir of component A at the outlet</p></li>
</ul>
</section>
<section id="example-data">
<h2>Example data<a class="headerlink" href="#example-data" title="Link to this heading">¶</a></h2>
<p>Example data can be downloaded from <a class="reference external" href="https://www.digitalrocksportal.org/projects/326">https://www.digitalrocksportal.org/projects/326</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="LBPM model summary" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="protocols/centrifuge.html" class="btn btn-neutral float-right" title="Color model – Centrifuge Protocol" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>